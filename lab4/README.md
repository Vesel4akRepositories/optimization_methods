# 4. CI/CD lab
___
### Задачи

__0. Написать “плохой” CI/CD файл, который работает, но в нем есть не менее пяти “bad practices” по написанию CI/CD__
__1. Написать “хороший” CI/CD, в котором эти плохие практики исправлены__
__2. В Readme описать каждую из плохих практик в плохом файле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат__
___

## Ход работы
### Плохой CI/CD файл

```yaml
name: Bad CI/CD

on:
  push:
    branches:
      - '*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@master

      - name: Set up Node.js
        uses: actions/setup-node@latest
        with:
          node-version: '14'

      - name: Install dependencies
        run: npm install

      - name: Run tests
        run: npm test

      - name: Deploy
        run: |
          echo "Deploying to production"
          scp -r ./build user@server:/var/www/app
        env:
          DEPLOY_PASSWORD: "supermegasecretpassword"

```

### Хороший CI/CD файл

```yaml
name: Good CI/CD

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-24.04
    strategy:
      matrix:
        node-version: [14.x, 16.x]

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Deploy
        if: github.ref == 'refs/heads/main' && success()
        run: |
          echo "Deploying to production"
          scp -r ./build user@server:/var/www/app
        env:
          DEPLOY_PASSWORD: ${{ secrets.DEPLOY_PASSWORD }}

```

### Описание плохих практик в "плохом" CI/CD файле и их исправление в "хорошем" файле
___
__1. Использование actions/checkout@master вместо версии тега__
__Причина почему практика плохая:__ Указание ветки master при использовании GitHub Actions (actions/checkout@master) может привести к неожиданным изменениям, так как ветка master действия может обновляться. Это снижает предсказуемость и стабильность процесса CI/CD.
__Метод исправления плохой практики:__ В "хорошем файле" используется actions/checkout@v3, для использования стабильной и фиксированной версии, предотвращая непредвиденные изменения.
___
__2. Отсутствие кэширования зависимостей__
__Причина почему практика плохая:__ Каждый запуск CI/CD процесса будет заново устанавливать зависимости, что увеличивает время выполнения сборки и тестов.
__Метод исправления плохой практики:__ В исправленном файле добавлено кэширование зависимостей через cache: 'npm' в шаге Set up Node.js. Это значительно ускоряет процесс установки зависимостей за счёт повторного использования пакетов.
___
__3. Жестко закодированные секреты в файле__
__Причина почему практика плохая:__ Хранение секретов (например, паролей) в открытом виде в файле конфигурации повышает риск компрометации чувствительной информации.
__Метод исправления плохой практики:__ В 2-ом файле используется ${{ secrets.DEPLOY_PASSWORD }} для безопасного хранения и использования секретов. Это обеспечивает защиту конфиденциальных данных и упрощает управление ими через интерфейс GitHub.
___
__4. Использование ubuntu-latest и отсутствие фиксированной версии ОС__
__Причина почему практика плохая:__ Использование ubuntu-latest может привести к неожиданным изменениям в среде выполнения, так как версия ОС может обновляться. Это может вызвать несовместимости или ошибки, связанные с изменениями в системе.
__Метод исправления плохой практики:__ В испраленном файле явно указана версия ОС ubuntu-24.04, что обеспечивает стабильность и предсказуемость среды выполнения CI/CD процесса.
___ 
__5. Деплой на все ветки без условий__
__Причина почему практика плохая:__ Деплой на все ветки может привести к непреднамеренным развертываниям, что нежелательно для окружений, предназначенных только для продакшн.
__Метод исправления плохой практики:__ В файле с "хорошей" практикой деплой выполняется только при пуше в ветку main и при успешном выполнении предыдущих шагов, что обеспечивает контроль над процессом деплоя и предотвращает случайные развертывания.
___
